<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
        <title>TechDemo</title>
        <style>
          canvas#spriteLayer{
          }
          div#gameField{
            position: absolute;
            top: 20px;
            left: 20px;
            border-color: black;
            border-weight: 1px;
            border-style: solid;
          }
        </style>
  <script type="text/javascript"
          src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js">
  </script>
  <script type="text/javascript" src="creeper.js"></script>
  <script type="text/javascript">
    
    var terrain = [{x:300, y:210},
                   {x:300, y:220},
                   {x:300, y:230},
                   {x:300, y:240},
                   {x:300, y:250},
                   {x:300, y:260},
                   {x:300, y:270}];    
    var creep = new Creeper({ x: 200, y: 200});
    creep.terrain = terrain;
    
    var mouseDown = 0;
    var renderTimer;
    function renderLoop(){
      creep.step();
      $("#spriteLayer").each(function(){
        var context = this.getContext('2d');
        context.clearRect(0,0,800,600);
        context.fillStyle ="#eee";
        context.strokeRect( creep.location.x-5, creep.location.y-5, 10, 10 );
        context.fillRect( creep.location.x-5, creep.location.y-5, 10, 10 );
        context.fillStyle = "#cd853f";
        for(var index in terrain){
          var block = terrain[index];
          context.strokeRect( block.x, block.y, 10, 10);
          context.fillRect( block.x, block.y, 10, 10);
        }
      });
    }
    $(document).ready(function(){
       renderLoop();
       $("#spriteLayer").mousemove(function(e){
         if(mouseDown){
           creep.destination = {x:e.offsetX, y: e.offsetY};
         }
       });

       // TODO : Mouse down/up should be on a document basis.  Incase I slide off the canvas
       $("#spriteLayer").mousedown(function(e){
         mouseDown++;
       });
       $("#spriteLayer").mouseup(function(e){
         mouseDown--;
       });
       $("#spriteLayer").mousedown(function(e){
         creep.destination = {x: e.offsetX, y: e.offsetY};
       });
       renderTimer = setInterval(renderLoop, 100);
    }); 
  </script>
</head>

<body>
  <div id="gameField">
    <canvas id="spriteLayer" width="800" height="600">
    </canvas>
  </div>
</body>
</html>
